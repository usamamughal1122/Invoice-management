<div class="dashboard-wrapper container-fluid px-4 py-4">

  <!-- HEADER SECTION -->
  <div class="header-section d-flex justify-content-between align-items-center flex-wrap gap-3 mb-4">
    <div>
      <p class="fw-bold text-dark mb-0">Inventory Management</p>
      <small class="">Overview of assets, usage, and employees</small>
    </div>
    <button class="btn btn-outline-primary btn-sm" (click)="reloadDashboard()">
      <i class="bi bi-arrow-clockwise me-1"></i> Refresh
    </button>
  </div>

  <!-- SECTION 1: FINANCIAL OVERVIEW (Sales & Purchase) -->
  <div class="section-divider">
    <h6 class="text-dark-50"><i class="bi bi-cash-coin me-2"></i>Financial Overview</h6>
  </div>
  <div class="row g-4">
    <div class="col-md-4">
      <div class="summary-card card-primary">
        <div class="card-icon"><i class="bi bi-cart-check"></i></div>
        <div class="card-content">
          <h6 class="card-label">Total Sales</h6>
          <h5 appCountUp [target]="totalSales" [duration]="900"></h5>
          <p class="card-description">Revenue from all sales</p>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="summary-card card-info">
        <div class="card-icon"><i class="bi bi-bag-check"></i></div>
        <div class="card-content">
          <h6 class="card-label">Total Purchase</h6>
          <h5 appCountUp [target]="totalPurchase" [duration]="900"></h5>
          <p class="card-description">Total procurement costs</p>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="summary-card card-success">
        <div class="card-icon"><i class="bi bi-box-seam"></i></div>
        <div class="card-content">
          <h6 class="card-label">Sold Items</h6>
          <h5 appCountUp [target]="totalSoldItems" [duration]="900"></h5>
          <p class="card-description">Total items sold</p>
        </div>
      </div>
    </div>
  </div>

  <!-- SECTION 2: STOCK OVERVIEW -->
  <div class="section-divider">
    <h6 class="text-white-50"><i class="bi bi-box-seam me-2"></i>Stock Overview</h6>
  </div>
  <div class="row g-4">
    <div class="col-md-4">
      <div class="summary-card card-primary">
        <div class="card-icon"><i class="bi bi-boxes"></i></div>
        <div class="card-content">
          <h6 class="card-label">Total Stock</h6>
          <h5 appCountUp [target]="dashboardList.length || 0" [duration]="700"></h5>
          <p class="card-description">All inventory items</p>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="summary-card card-info">
        <div class="card-icon"><i class="bi bi-check-circle"></i></div>
        <div class="card-content">
          <h6 class="card-label">Available Stock</h6>
          <h5 appCountUp [target]="countStatus('Available')" [duration]="700"></h5>
          <p class="card-description">Ready for assignment</p>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="summary-card card-warning">
        <div class="card-icon"><i class="bi bi-x-circle"></i></div>
        <div class="card-content">
          <h6 class="card-label">Unavailable Stock</h6>
          <h5 appCountUp [target]="countStatus('UnAvailable')" [duration]="700"></h5>
          <p class="card-description">Out of stock items</p>
        </div>
      </div>
    </div>
  </div>

  <!-- SECTION 3: ANALYTICS & CHARTS -->
  <div class="section-divider">
    <h6 class="text-dark-50 mt-4"><i class="bi bi-graph-up me-2"></i>Analytics & Insights</h6>
  </div>
  <div class="row g-4 mb-5">
    <!-- Status Distribution Chart - Small -->
    <div class="col-lg-6 col-md-6">
      <div class="modern-card h-100 shadow-sm">
        <div class="modern-card-header">
          <span><i class="bi bi-pie-chart me-2"></i>Status</span>
          <p>{{statusChartData.labels?.length}}</p>
        </div>
        <div class="chart-container" style="height: 200px; padding: 15px;">
          <canvas baseChart
            [data]="statusChartData"
            [type]="'doughnut'"
            [options]="doughnutChartOptions">
          </canvas>
        </div>
      </div>
    </div>

    <!-- Brand Distribution Chart - Small -->
    <div class="col-lg-6 col-md-6">
      <div class="modern-card h-100 shadow-sm">
        <div class="modern-card-header">
          <span><i class="bi bi-diagram-3 me-2"></i>Brands</span>
          <p>{{brandChartData.labels?.length}}</p>
        </div>
        <div class="chart-container" style="height: 200px; padding: 15px;">
          <canvas baseChart
            [data]="brandChartData"
            [type]="'pie'"
            [options]="pieChartOptions">
          </canvas>
        </div>
      </div>
    </div>

    <!-- Category Distribution Chart - Medium -->
    <div class=" col-12">
      <div class="modern-card h-100 shadow-sm">
        <div class="modern-card-header">
          <span><i class="bi bi-bar-chart me-2"></i>Top Categories</span>
          <p>{{categoryChartData.labels?.length}}</p>
        </div>
        <div class="chart-container" style="height: 200px; padding: 15px;">
          <canvas baseChart
            [data]="categoryChartData"
            [type]="'bar'"
            [options]="barChartOptions">
          </canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- SECTION 4: TOP PRODUCTS & RECENT INVOICES (SIDE BY SIDE) -->
  <div class="section-divider mb-3">
    <h6 class="text-dark-50"><i class="bi bi-star me-2"></i>Top Products & Recent Invoices</h6>
  </div>
  
  <div class="row g-4 mb-5">
    <!-- LEFT: TOP PRODUCTS -->
    <div class="col-lg-8 col-md-12">
      <div class="modern-card h-100 shadow-sm">
        <div class="modern-card-header">
          <span><i class="bi bi-trophy me-2"></i>Top Performing Products</span>
        </div>
        <div class="table-responsive">
         <table class="modern-table table mb-0 align-middle">
        <thead>

          <tr>
            <th style="width: 5%">#</th>
            <th style="width: 20%">Name</th>
            <th style="width: 15%">Brand</th>
            <th style="width: 15%">Status</th>
            <th style="width: 10%">Action</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of topProducts | slice:0:5; let i = index" class="table-row-hover">
            <td>{{ i + 1 }}</td>
            <td><strong>{{ item.name }}</strong></td>
            <td>{{ item.brand?.brand }}</td>
            <td>
              <span class="modern-badge"
                [ngClass]="{
                  'badge-success': item.status === 'Available',
                  'badge-primary': item.status === 'UnAvailable',
                  'badge-warning': item.status === 'Repair',
                  'badge-secondary': item.status === 'Retired',
                  'badge-danger': item.status === 'Lost'
                }">
                {{ item.status }}
              </span>
            </td>
            <td>
              <button class="btn-view btn-sm" (click)="viewItem(item)">
                <i class="bi bi-eye"></i> View
              </button>
            </td>
          </tr>
          <tr *ngIf="dashboardList.length === 0">
            <td colspan="8">
              <div class="empty-state">
                <i class="bi bi-inbox"></i>
                <p>No products found</p>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
        </div>
      </div>
    </div>

    <!-- RIGHT: RECENT INVOICES -->
    <div class="col-lg-4 col-md-12">
      <div class="modern-card h-100 shadow-sm">
        <div class="modern-card-header d-flex justify-content-between align-items-center">
          <span><i class="bi bi-receipt me-2"></i>Recent Invoices</span>
          <span class="badge bg-black" appCountUp [target]="invoices.length || 0" [duration]="600"></span>
        </div>
        
        <!-- Invoice Summary Stats -->
        <div class="invoice-summary p-3  border-bottom background-light">
          <div class="row g-2">
            <div class="col-4 text-center">
              <small class="text-muted d-block" style="font-size: 0.7rem;">TOTAL AMOUNT</small>
              <h6 class="mb-0 fw-bold text-dark" appCountUp [target]="getTotalInvoiceAmount()" currency="PKR" [decimals]="0" [duration]="900"></h6>
            </div>
            <div class="col-4 text-center border-start border-end">
              <small class="text-success d-block" style="font-size: 0.7rem;">PAID</small>
              <h6 class="mb-0 fw-bold text-success" appCountUp [target]="getPaidAmount()" currency="PKR" [decimals]="0" [duration]="900"></h6>
            </div>
            <div class="col-4 text-center">
              <small class="text-warning d-block" style="font-size: 0.7rem;">UNPAID</small>
              <h6 class="mb-0 fw-bold text-warning" appCountUp [target]="getUnpaidAmount()" currency="PKR" [decimals]="0" [duration]="900"></h6>
            </div>
          </div>
        </div>

        <div class="invoice-list-container" style="max-height: 350px; overflow-y: auto; padding: 15px; scrollbar-width: thin; scrollbar-color: #000000 #f1f1f1;">
          
          <!-- Invoice Card -->
          <div *ngFor="let invoice of invoices | slice:0:10" 
              class="invoice-card mb-3 p-3 border rounded-3 shadow-sm bg-white position-relative"
              [ngClass]="{'transformed': isMouseOver, 'shadow-sm': isMouseOver}"
              (mouseenter)="isMouseOver = true"
              (mouseleave)="isMouseOver = false">
            
       
            <span class="position-absolute top-0 end-0 m-2 badge"
                  [ngClass]="{
                    'bg-warning text-dark': invoice.statuses === 'Pending',
                    'bg-success': invoice.statuses === 'Paid',
                    'bg-danger': invoice.statuses === 'Cancelled',
                    'bg-info': invoice.statuses === 'Processing'
                  }">
              {{ invoice.statuses }}
            </span>

            <!-- Invoice Header -->
            <div class="d-flex align-items-center mb-2">
              <div class="invoice-icon me-3 d-flex align-items-center justify-content-center rounded-circle bg-primary bg-opacity-10" 
                   style="width: 45px; height: 45px;">
                <i class="bi bi-file-earmark-text text-primary fs-5"></i>
              </div>
              <div class="flex-grow-1">
                <h6 class="mb-0 fw-bold text-dark">{{ invoice.invoiceNumber }}</h6>
                <small class="text-muted">
                  <i class="bi bi-calendar3 me-1"></i>
                  {{ invoice.createdAt | date:'MMM d, y' }}
                </small>
              </div>
            </div>

            <!-- Client Info -->
            <div class="client-info mb-2 ps-2 border-start border-primary border-3">
              <div class="d-flex align-items-center mb-1">
                <i class="bi bi-person-circle me-2 text-primary"></i>
                <strong class="text-dark">{{ invoice.client?.name }}</strong>
              </div>
              <div class="d-flex align-items-center">
                <i class="bi bi-envelope me-2 text-muted"></i>
                <small class="text-muted">{{ invoice.client?.email }}</small>
              </div>
            </div>

            <!-- Invoice Details -->
            <div class="invoice-details d-flex justify-content-between align-items-center pt-2 border-top">
              <div>
                <small class="text-muted d-block">Total Amount</small>
                <h5 class="mb-0 text-black fw-bold">{{ invoice.total | currency:'PKR':'symbol':'1.0-0' }}</h5>
              </div>
              <div class="text-end">
                <small class="text-muted d-block">Items</small>
                <span class="badge bg-secondary fs-6">{{ invoice.items?.length || 0 }}</span>
              </div>
            </div>

            <!-- Optional: Tax Info -->
            <div class="mt-2 pt-2 border-top" *ngIf="invoice.taxAmount > 0">
              <div class="d-flex justify-content-between">
                <small class="text-muted">Subtotal:</small>
                <small>{{ invoice.subTotal | currency:'PKR':'symbol':'1.0-0' }}</small>
              </div>
              <div class="d-flex justify-content-between">
                <small class="text-muted">Tax ({{ invoice.taxPercent }}%):</small>
                <small>{{ invoice.taxAmount | currency:'PKR':'symbol':'1.0-0' }}</small>
              </div>
            </div>

          </div>

          <!-- Empty State -->
          <div *ngIf="invoices.length === 0" class="text-center py-5">
            <i class="bi bi-receipt fs-1 text-muted"></i>
            <p class="text-muted mt-2">No invoices found</p>
          </div>

        </div>
      </div>
    </div>
  </div>

  <!-- SECTION 5: RECENT ACTIVITY -->
  <div class="section-divider mb-3">
    <h6 class="text-dark-50"><i class="bi bi-clock-history me-2"></i>Recent Activity</h6>
  </div>
  <div class="row g-4 mb-4">
    <!-- Recent Inventory -->
    <div class="col-lg-6 col-md-12">
      <div class="modern-card h-100 shadow-sm">
        <div class="modern-card-header">
          <span><i class="bi bi-box me-2"></i>Recent Products</span>
        </div>
        <div class="table-responsive">
          <table class="modern-table table mb-0 align-middle">
            <thead>
              <tr>
                <th>#</th>
                <th>Name</th>
                <th>Status</th>
                <th>Available Stock</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of dashboardList | slice:0:5; let i = index" class="table-row-hover">
                <td>{{ i + 1 }}</td>
                <td><strong>{{ item.name }}</strong></td>
                <td>
                  <span class="modern-badge"
                    [ngClass]="{
                      'badge-success': item.status === 'Available',
                      'badge-primary': item.status === 'UnAvailable',
                      'badge-warning': item.status === 'Repair',
                      'badge-secondary': item.status === 'Retired',
                      'badge-danger': item.status === 'Lost'
                    }">
                    {{ item.status }}
                  </span>
                </td>
                <td>{{ item.quantity_available }}</td>
              </tr>
              <tr *ngIf="dashboardList.length === 0">
                <td colspan="4">
                  <div class="empty-state">
                    <i class="bi bi-inbox"></i>
                    <p>No recent inventory</p>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Employee Overview -->
    <div class="col-lg-6 col-md-12">
      <div class="modern-card h-100 shadow-sm">
        <div class="modern-card-header">
          <span><i class="bi bi-people me-2"></i>Employee Overview</span>
        </div>
        <div class="table-responsive">
          <table class="modern-table table mb-0 align-middle">
            <thead>
              <tr>
                <th>#</th>
                <th>Name</th>
                <th>Department</th>
                <th>Salary</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let emp of recentRequests | slice:0:5; let i = index" class="table-row-hover">
                <td>{{ i + 1 }}</td>
                <td><strong>{{ emp.name }}</strong></td>
                <td>{{ emp.department }}</td>
                <td>{{ emp.salary | currency:'PKR':'symbol':'1.0-0' }}</td>
                <td>
                  <span class="modern-badge"
                    [ngClass]="emp.active ? 'badge-success' : 'badge-danger'">
                    {{ emp.active ? 'Active' : 'Inactive' }}
                  </span>
                </td>
              </tr>
              <tr *ngIf="recentRequests.length === 0">
                <td colspan="5">
                  <div class="empty-state">
                    <i class="bi bi-inbox"></i>
                    <p>No employee data available</p>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

</div>

<!-- Hidden component to fetch employee data -->
<app-session-list (employeList)="AllEmployes($event)" style="display: none"></app-session-list>

<ngx-spinner
  bdColor="rgba(256, 256, 256, 0.8)"
  size="large"
  color="#fff"
  type="ball-scale-multiple"
  [fullScreen]="true"
  template="<img src='assets/stockify.png' />"
>
</ngx-spinner>
