<div class="container-fluid py-4"
  style="background: linear-gradient(135deg, #ffffff 0%, #f8f8f8 100%); min-height: 100vh; font-size: 14px; padding: 20px;">

  <!-- Header Section -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h2 class="fw-bold mb-1" style="font-size: 20px; color: #1a1a1a;">
        <i class="bi bi-receipt-cutoff me-2" style="color: #d4af37;"></i>Invoice Management
      </h2>
      <p class="text-muted mb-0" style="font-size: 14px;">Manage all your invoices in one place</p>
    </div>
    <div class="d-flex align-items-center gap-3">
      <button class="btn px-4 py-2 shadow-sm" (click)="openCreateInvoiceModal(createInvoiceModal)"
        style="background: linear-gradient(135deg, #e3f6fd, #e3f6fd 100%); color: #1a1a1a; border: none; border-radius: 8px; font-size: 14px; font-weight: 600;">
        <i class="bi bi-plus-circle-fill me-2"></i>Create New Invoice
      </button>
    </div>
  </div>

  <!-- Invoices List Section -->
  <div class="invoice-list" *ngIf="invoice.length > 0">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h4 class="fw-bold mb-0" style="font-size: 16px; color: #1a1a1a;">
        <i class="bi bi-file-earmark-text me-2" style="color: #d4af37;"></i>All Invoices
      </h4>
      <div class="badge px-3 py-2 rounded-pill"
        style="font-size: 15px; background: linear-gradient(135deg, #e3f6fd, #e3f6fd 100%); color: #1a1a1a;margin-left: 70%;">
        <i class="bi bi-calendar3 me-2"></i>{{ today | date:'mediumDate' }}
      </div>
      <span class="badge px-3 py-2 rounded-pill"
        style="font-size: 15px; background: linear-gradient(135deg, #e3f6fd, #e3f6fd 100%); color: #000000;">
        {{ invoice.length }} Invoices
      </span>
    </div>

    <!-- Invoice Table -->
    <div class="card shadow-sm"
      style="border-radius: 12px; overflow: hidden; border: 1px solid #e8e8e8; background: #ffffff;">
      <div class="table-responsive">
        <table class=" table table-hover mb-0" style="font-size: 14px; background: linear-gradient(135deg, #e3f6fd, #e3f6fd 100%); color: #000000;">
          <thead class="background">
            <tr>
              <th class="py-3 px-3 border-0">
                <i class="bi bi-hash me-2" style="color: #000000;"></i>Invoice #
              </th>
              <th class="py-3 px-3 border-0">
                <i class="bi bi-person-circle me-2" style="color: #000000;"></i>Client
              </th>
              <th class="py-3 px-3 border-0">
                <i class="bi bi-calendar-event me-2" style="color: #000000;"></i>Date
              </th>
              <th class="py-3 px-3 border-0">
                <i class="bi bi-check-circle me-2" style="color: #010101;"></i>Status
              </th>
              <th class="py-3 px-3 border-0">
                <i class="bi bi-cart3 me-2" style="color: #000000;"></i>Items
              </th>
              <th class="py-3 px-3 border-0">
                <i class="bi bi-currency-dollar me-2" style="color: #000000;"></i>Total
              </th>
              <th class="py-3 px-3 border-0 text-center">
                <i class="bi bi-gear me-2" style="color: #000000;"></i>Actions
              </th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let inv of invoice; let idx = index"
              style="background: #fff; border-bottom: 1px solid #e8e8e8; transition: all 0.3s;"
              onmouseover="this.style.background='#fafafa'" onmouseout="this.style.background='#fff'">
              <td class="py-3 px-3 align-middle">
                <span class="badge px-2 py-1" style="background: #e8e8e8cc; color: #000000cc; font-weight: 600;">
                  #{{ inv.invoiceNumber }}
                </span>
              </td>
              <td class="py-3 px-3 align-middle">
                <div class="d-flex align-items-center">
                  <div class="rounded-circle p-2 me-2"
                    style="width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;background: linear-gradient(135deg, #e3f6fd, #e3f6fd 100%);">
                    <i class="bi bi-person" style="font-size: 14px; color: #1a1a1a;"></i>
                  </div>
                  <span class="fw-semibold" style="color: #1a1a1a;">{{ inv.client?.name }}</span>
                </div>
              </td>
              <td class="py-3 px-3 align-middle">
                <span style="color: #666;">{{ inv.purchaseDates | date:'mediumDate' }}</span>
              </td>
              <td class="py-3 px-3 align-middle">
                <span class="badge px-2 py-1" [ngStyle]="{'background': inv.statuses === 'Paid' ? '#28a745' :
                   inv.statuses === 'Pending' ? '#ffc107' : 
                   inv.statuses === 'Overdue' ? '#dc3545' :
                  '#6c757d', 'color': '#ffffff'}">
                  {{ inv.statuses }}
                </span>
              </td>
              <td class="py-3 px-3 align-middle">
                <span class="badge px-2 py-1" style="background: #f8f8f8; color: #1a1a1a; border: 1px solid #d4af37;">
                  {{ inv.items?.length || 0 }} items
                </span>
              </td>
              <td class="py-3 px-3 align-middle">
                <span class="fw-bold" style="font-size: 15px; color: #000000;"> {{ (inv.total / 100) | currency }}</span>
              </td>
              <td class="py-3 px-3 align-middle text-center">
                <!-- <button class="btn btn-sm px-2 py-2 me-2" (click)="sendInvoiceEmail(inv)"
                style="border-radius: 5px; background: #d4af37; color: #1a1a1a; border: none;">
                <i class="bi bi-envelope-fill"></i>
              </button> -->

                <button class="btn btn-sm px-3" (click)="openInvoiceDetailsModal(invoiceDetailsModal, inv)"
                  style="border-radius: 5px; background: #e8e8e8cc; color: #000000cc; border: none;">
                  <i class="bi bi-eye-fill me-1"></i>View
                </button>
              </td>

            </tr>
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      <div class="d-flex justify-content-between align-items-center px-3 py-3 border-top">
        <div class="text-muted small">
          Showing page <strong>{{ page }}</strong> of <strong>{{ totalPages }}</strong>
        </div>

        <nav>
          <ul class="pagination mb-0">
            <li class="page-item" [class.disabled]="page === 1">
              <a class="px-3 pagenation" (click)="prevPage()">
                << </a>
            </li>

            <ng-container *ngFor="let p of [].constructor(totalPages); let i = index">
              <li class="page-item pagenatio-gap" [class.active]="page === i + 1">
                <a class="page-link rounded-pill pagenation-number" (click)="page = i + 1; goToPage(i+1)">
                  {{ i + 1 }}
                </a>
              </li>
            </ng-container>

            <li class="page-item" [class.disabled]="page === totalPages">
              <a class="px-3 pagenation" (click)="nextPage()">>></a>
            </li>
          </ul>
        </nav>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="invoice.length === 0" class="text-center py-5">
    <div class="card shadow-sm mx-auto" style="max-width: 500px; border-radius: 12px; border: 1px solid #e8e8e8;">
      <div class="card-body p-5">
        <i class="bi bi-inbox display-1 mb-3 d-block" style="color: #d4af37;"></i>
        <h4 class="fw-bold mb-2" style="color: #1a1a1a;">No Invoices Yet</h4>
        <p class="text-muted mb-4">Get started by creating your first invoice</p>
        <button class="btn px-4 py-2" (click)="openCreateInvoiceModal(createInvoiceModal)"
          style="background: linear-gradient(135deg, #d4af37 0%, #f4d03f 100%); color: #1a1a1a; border: none; border-radius: 8px; font-size: 14px; font-weight: 600;">
          <i class="bi bi-plus-circle-fill me-2"></i>Create Your First Invoice
        </button>
      </div>
    </div>
  </div>

</div>

<!-- Create Invoice Modal component -->
<ng-template #createInvoiceModal let-modal>
  <app-invoice-model [modal]="modal" (invoiceCreated)="onInvoiceCreated()"></app-invoice-model>
</ng-template>

<!-- Invoice Details Modal -->
<ng-template #invoiceDetailsModal let-modal>
  <div class="modal-header border-0" style="background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
           display: flex;
           justify-content: space-between;
           align-items: center;
           padding: 1rem;">

    <div style="display: flex; align-items: center;">
      <h5 class="modal-title fw-bold mb-0" style="font-size: 16px; color: #ffffff;">
        <i class="bi bi-file-earmark-text-fill me-2" style="color: #d4af37;"></i>
        Invoice Details - #{{ selectedInvoiceForView?.invoiceNumber }}
      </h5>
    </div>

    <div style="display: flex; align-items: center; gap: 1rem;">
      <h5 class="modal-title fw-bold mb-0" style="font-size: 16px; color: #d4af37;">
        <i class="bi bi-check-circle me-2"></i>{{ selectedInvoiceForView?.statuses }}
      </h5>

      <button type="button" class="btn-close btn-close-white" (click)="modal.dismiss()"></button>
    </div>
  </div>

  <div class="modal-body p-0" style="max-height: 70vh; overflow-y: auto;" #invoiceDetailsContent>
    <div class="p-4" style="background: #ffffff;">

      <!-- Invoice Header Info -->
      <div class="row mb-4">
        <div class="col-md-6">
          <div class="card shadow-sm" style="border-radius: 8px; border: 1px solid #e8e8e8;">
            <div class="card-body p-3">
              <small class="d-block mb-2" style="font-size: 12px; color: #666;">Client Information</small>
              <h6 class="mb-2 fw-bold" style="font-size: 15px; color: #1a1a1a;">
                <i class="bi bi-person-circle me-2" style="color: #d4af37;"></i>{{
                selectedInvoiceForView?.client?.name }}
              </h6>
              <div class="mt-2" style="font-size: 13px; color: #666;">
                <div><i class="bi bi-envelope me-2" style="color: #d4af37;"></i>{{
                  selectedInvoiceForView?.client?.email || 'N/A' }}</div>
                <div><i class="bi bi-telephone me-2" style="color: #d4af37;"></i>{{
                  selectedInvoiceForView?.client?.phone || 'N/A' }}</div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="card shadow-sm" style="border-radius: 8px; border: 1px solid #e8e8e8;">
            <div class="card-body p-3">
              <small class="d-block mb-2" style="font-size: 12px; color: #666;">Invoice Information</small>
              <div style="font-size: 13px; color: #1a1a1a;">
                <div class="mb-2">
                  <i class="bi bi-calendar-event me-2" style="color: #d4af37;"></i>
                  <strong>Date:</strong> {{ selectedInvoiceForView?.purchaseDates | date:'mediumDate' }}
                </div>
                <div class="mb-2">
                  <i class="bi bi-shield-check me-2" style="color: #d4af37;"></i>
                  <strong>Due Date:</strong> {{ selectedInvoiceForView?.warrantyExpirys | date:'mediumDate' }}
                </div>
                <div>
                  <i class="bi bi-percent me-2" style="color: #d4af37;"></i>
                  <strong>Tax Rate:</strong> {{ selectedInvoiceForView?.taxPercent }}%
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Items Table -->
      <div class="mb-4">
        <h6 class="fw-bold mb-3" style="font-size: 14px; color: #1a1a1a;">
          <i class="bi bi-cart3 me-2" style="color: #d4af37;"></i>Invoice Items
        </h6>
        <div class="table-responsive" style="border-radius: 8px; overflow: hidden; border: 1px solid #e8e8e8;">
          <table class="table table-hover mb-0" style="font-size: 13px;">
            <thead style="background: linear-gradient(135deg, #f8f8f8 0%, #f0f0f0 100%);">
              <tr>
                <th class="py-2 px-3 border-0" style="color: #1a1a1a;">Item Name</th>
                <th class="py-2 px-3 border-0" style="color: #1a1a1a;">Unit Price</th>
                <th class="py-2 px-3 border-0" style="color: #1a1a1a;">Quantity</th>
                <th class="py-2 px-3 border-0" style="color: #1a1a1a;">Subtotal</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of selectedInvoiceForView?.items">
                <td class="py-2 px-3">
                  <i class="bi bi-box-seam me-2" style="color: #d4af37;"></i>{{ item.name }}
                </td>
                <td class="py-2 px-3">{{ (item.price / 100) | currency }}</td>
                <td class="py-2 px-3">
                  <span class="badge px-2 py-1" style="background: #f8f8f8; color: #1a1a1a; border: 1px solid #d4af37;">
                    {{ item.quantity }}
                  </span>
                </td>
                <td class="py-2 px-3 fw-bold">{{ (item.subtotal / 100) | currency }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Invoice Summary -->
      <div class="row">
        <div class="col-md-8"></div>
        <div class="col-md-4">
          <div class="card shadow-sm"
            style="border-radius: 8px; background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%); border: 1px solid #d4af37;">
            <div class="card-body p-3">
              <div class="d-flex justify-content-between mb-2 pb-2" style="border-bottom: 1px solid #404040;">
                <span style="font-size: 13px; color: #cccccc;">Subtotal:</span>
                <span class="fw-bold" style="font-size: 13px; color: #ffffff;">{{ (selectedInvoiceForView?.subTotal / 100) | currency }}</span>
              </div>
              <div class="d-flex justify-content-between mb-2 pb-2" style="border-bottom: 1px solid #404040;">
                <span style="font-size: 13px; color: #cccccc;">Tax ({{ selectedInvoiceForView?.taxPercent }}%):</span>
                <span class="fw-bold" style="font-size: 13px; color: #ffffff;">{{ (selectedInvoiceForView?.taxAmount / 100) | currency }}</span>
              </div>
              <div class="d-flex justify-content-between align-items-center">
                <span class="fw-bold" style="font-size: 14px; color: #d4af37;">Total Amount:</span>
                <span class="fw-bold" style="font-size: 17px; color: #d4af37;">{{ (selectedInvoiceForView?.total / 100) | currency }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <div class="modal-footer border-0 no-print" style="background: #f8f8f8;">
    <button class="btn px-3 py-2" (click)="modal.dismiss()"
      style="border-radius: 5px; font-size: 14px; background: #666666; color: #ffffff; border: none;">
      <i class="bi bi-x-circle me-2"></i>Close
    </button>
    <button class="btn px-3 py-2" (click)="downloadModalPDF(selectedInvoiceForView._id)"
      style="background: linear-gradient(135deg, #d4af37 0%, #f4d03f 100%); color: #1a1a1a; border: none; border-radius: 5px; font-size: 14px; font-weight: 600;">
      <i class="bi bi-download me-2"></i>Download PDF
    </button>

    <button class="btn btn-sm px-3 py-3 me-3" (click)="sendInvoiceEmail(selectedInvoiceForView)"
      style="border-radius: 5px; background: linear-gradient(135deg, #d4af37 0%, #f4d03f 100%); color: #1a1a1a; border: none;">
      <i class="bi bi-envelope-fill"></i>
    </button>
    <button *ngIf="selectedInvoiceForView?.statuses !== 'Paid'" class="btn btn-sm px-3 py-2 ms-2"
      (click)="openPaymentModal(selectedInvoiceForView)"
      style="border-radius: 5px; background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: #ffffff; border: none; font-weight: 600;">
      <i class="bi bi-credit-card-2-front me-2"></i>Pay Now
    </button>
     <span  *ngIf="selectedInvoiceForView?.statuses === 'Paid'"
      class="py-3 px-3 align-middle badge bg-success">
      Paid
   </span>

  </div>
</ng-template>

<ngx-spinner bdColor="rgba(256, 256, 256, 0.8)" size="large" color="#d4af37" type="ball-scale-multiple"
  [fullScreen]="true" template="<img src='assets/stockify.png' />">
</ngx-spinner>