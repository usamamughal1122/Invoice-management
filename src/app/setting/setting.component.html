<div class="setting-wrapper" [class.dark]="theme==='dark'">

  <!-- HEADER -->
  <div class="header-section">
    <div>
      <h3 class="page-title">Settings</h3>
      <p class="page-subtitle">Manage system configurations</p>
    </div>

    <div class="header-actions">
      <button (click)="toggleTheme()" class="theme-toggle">
        {{ theme | titlecase }} Mode
      </button>

      <button (click)="saveAll()" class="gold-btn" title="Save all settings">Save All</button>
      <button (click)="exportSettings()" class="gold-btn" title="Export settings">Export</button>

      <label class="gold-btn import-label">
        Import
        <input type="file" accept="application/json" (change)="onImportFile($event)" style="display:none">
      </label>

      <button (click)="resetSettings()" class="theme-toggle" title="Reset to defaults">Reset</button>

      <button (click)="showAdvanced = !showAdvanced" class="theme-toggle" title="Toggle advanced JSON view">
        {{ showAdvanced ? 'Close Advanced' : 'Advanced' }}
      </button>
    </div>
  </div>

  <div style="display:flex; gap:20px; flex-wrap:wrap;">

    <!-- SIDEBAR -->
    <div class="sidebar" style="flex:1; min-width:200px;">
      <div class="sidebar-card">
        <button *ngFor="let sec of sections"
                (click)="setSection(sec.key)"
                class="section-btn"
                [class.active]="section===sec.key">
          <i [class]="'bi '+sec.icon" class="sec-icon"></i> {{ sec.label }}
        </button>
      </div>
    </div>

    <!-- CONTENT AREA -->
    <div style="flex:3; min-width:300px;">
      <div *ngFor="let s of sections">
        <div *ngIf="section===s.key" class="content-card" [class.dark]="theme==='dark'">
          <h5 class="section-title">{{ s.label }}</h5>

          <ng-container [ngSwitch]="s.key">

            <!-- GENERAL -->
            <div *ngSwitchCase="'general'">
              <div style="margin-bottom:10px">
                <label>Company Name</label>
                <input type="text" [(ngModel)]="general.companyName" [ngStyle]="inputStyle()">
              </div>
              <div style="margin-bottom:10px">
                <label>Upload Logo</label>
                <input type="file" (change)="onLogoUpload($event)" [ngStyle]="inputStyle()">
              </div>
              <div style="margin-bottom:10px">
                <label>Currency</label>
                <select [(ngModel)]="general.currency" [ngStyle]="inputStyle()">
                  <option>PKR</option>
                  <option>USD</option>
                  <option>AED</option>
                </select>
              </div>
              <button (click)="saveGeneral()" class="savebtn gold-btn">Save</button>
            </div>

            <!-- INVENTORY -->
            <div *ngSwitchCase="'inventory'">
              <div style="margin-bottom:10px">
                <label>Default Pagination Limit</label>
                <select [(ngModel)]="inventory.paginationLimit" [ngStyle]="inputStyle()">
                  <option>5</option>
                  <option>10</option>
                  <option>20</option>
                  <option>50</option>
                </select>
              </div>
              <div style="margin-bottom:10px">
                <label>Low Stock Alert</label>
                <input type="number" [(ngModel)]="inventory.lowStockAlert" [ngStyle]="inputStyle()">
              </div>
              <button (click)="saveInventory()" class="savebtn gold-btn">Save</button>
            </div>

            <!-- EMPLOYEES -->
            <div *ngSwitchCase="'employees'">
              <div style="margin-bottom:10px">
                <label>Default Role</label>
                <select [(ngModel)]="employees.defaultRole" [ngStyle]="inputStyle()">
                  <option>Employee</option>
                  <option>Manager</option>
                  <option>Admin</option>
                </select>
              </div>
              <div>
                <input type="checkbox" [(ngModel)]="employees.autoApproveLeave"> Auto Approve Leave
              </div>
              <button (click)="saveEmployees()" class="savebtn gold-btn">Save</button>
            </div>

            <!-- NOTIFICATIONS -->
            <div *ngSwitchCase="'notifications'">
              <div>
                <input type="checkbox" [(ngModel)]="notifications.lowStock"> Low Stock Alerts
              </div>
              <div>
                <input type="checkbox" [(ngModel)]="notifications.email"> Email Notifications
              </div>
              <button (click)="saveNotifications()" class="savebtn gold-btn">Save</button>
            </div>

          </ng-container>
        </div>
      </div>

      <!-- ADVANCED JSON EDITOR -->
      <div *ngIf="showAdvanced" class="modern-card advanced-json" [class.dark]="theme==='dark'">
        <h5 class="section-title">Advanced (JSON)</h5>
        <p style="font-size:13px; color:gray; margin-top:0;">Edit the full settings JSON. Use Import/Export to move settings between environments. Changes here must be saved with <strong>Save All</strong>.</p>
        <textarea [(ngModel)]="advancedJson" rows="12" [ngStyle]="inputStyle()"></textarea>
        <div style="display:flex; gap:8px; margin-top:10px;">
          <button class="gold-btn" (click)="applyImportedJson(advancedJson)">Apply to UI</button>
          <button class="gold-btn" (click)="exportSettings()">Export Current</button>
          <button class="theme-toggle" (click)="loadCurrentJson()">Load Current JSON</button>
        </div>
      </div>
    </div>

  </div>
</div>
